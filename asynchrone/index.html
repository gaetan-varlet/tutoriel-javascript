<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>L'asynchrone - Tutoriel JS</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js" defer></script>
        <script src="../js/bootstrap-3.0.3.min.js" defer></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
        <script>hljs.initHighlightingOnLoad();</script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
            <div class="container">

                <!-- Collapsed navigation -->
                <div class="navbar-header">
                    <!-- Expander button -->
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="..">Tutoriel JS</a>
                </div>

                <!-- Expanded navigation -->
                <div class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li >
                                <a href="..">Accueil</a>
                            </li>
                            <li class="dropdown active">
                                <a href="#" class="dropdown-toggle" data-toggle="dropdown">Chapitres <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li >
    <a href="../lesBasesDeJavaScript/">Les bases</a>
</li>
                                    
<li >
    <a href="../vraimentBienComprendreJavaScript/">Vraiment bien comprendre JavaScript</a>
</li>
                                    
<li >
    <a href="../developpementModerneJavascript/">Développement moderne</a>
</li>
                                    
<li class="active">
    <a href="./">L'asynchrone</a>
</li>
                                    
<li >
    <a href="../objetsEtFonctionsUtilesJavascript/">Objets et Fonctions utiles</a>
</li>
                                    
<li >
    <a href="../javascriptDebarqueDansLeNavigateur/">Dans le navigateur</a>
</li>
                                    
<li >
    <a href="../frameworksJavascript/">Les bibliothèques et frameworks</a>
</li>
                                </ul>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                            <li >
                                <a rel="next" href="../developpementModerneJavascript/">
                                    <i class="fa fa-arrow-left"></i> Previous
                                </a>
                            </li>
                            <li >
                                <a rel="prev" href="../objetsEtFonctionsUtilesJavascript/">
                                    Next <i class="fa fa-arrow-right"></i>
                                </a>
                            </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#lasynchrone-en-javascript">L'asynchrone en Javascript</a></li>
            <li><a href="#javascript-est-synchrone-et-mono-thread">JavaScript est synchrone et mono-thread</a></li>
            <li><a href="#recuperer-le-resultat-dune-methode-asynchrone">Récupérer le résultat d'une méthode asynchrone</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="lasynchrone-en-javascript">L'asynchrone en Javascript</h1>
<h2 id="javascript-est-synchrone-et-mono-thread">JavaScript est synchrone et mono-thread</h2>
<p>En JavaScript, il y a un seul fil d'exécution, chaque ligne est exécutée l'une après l'autre en attendant la fin de l'exécution de la ligne précédente.</p>
<pre><code class="js">function main() {
    console.log('avant')
    const res = sumSync(2, 5)
    console.log(res)
    console.log('après')
}
</code></pre>

<pre><code>avant
7
après
</code></pre>

<p>Il est possible d'exécuter du code de manière <strong>asynchrone</strong> sans bloquer l'exécution de la suite du programme. La fonction asynchrone est placée dans une file d'attente qui va exécuter toutes les fonctions qu'elle contient. On parle d'<strong>event loop</strong>. Une fois le traitement terminé, on revient dessus pour exploiter les résultats.</p>
<pre><code class="js">const myFunction = () =&gt; {
    console.log('Exécuté dans 1 seconde')
}
setTimeout(myFunction, 1000)
console.log('Exécuté en premier immédiatement')
</code></pre>

<pre><code>Exécuté en premier immédiatement
Exécuté dans 1 seconde
</code></pre>

<h2 id="recuperer-le-resultat-dune-methode-asynchrone">Récupérer le résultat d'une méthode asynchrone</h2>
<h3 id="les-callbacks">Les callbacks</h3>
<p>C'est la méthode la plus ancienne.
Un callback est une fonction que l'on passe en paramètre d'une fonction asynchrone, qui une fois qu'elle a fini sa tâche va appeler la fonction callback en lui passant le résultat</p>
<pre><code class="js">const myFunction = (a, b) =&gt; a + b
const callback = () =&gt; console.log('exécution asynchrone : ', myFunction(4, 5))
setTimeout(callback, 1000)
console.log('exécution synchrone : ', myFunction(2, 3))
</code></pre>

<pre><code>exécution synchrone :  5
exécution asynchrone :  9
</code></pre>

<p>Exemple sur une fonction synchrone qui logue la somme une fois le calcul effectué, mais le principe est le même sur une fonction asynchrone :</p>
<pre><code class="js">function addition(nombre1, nombre2, callback) {
    const somme = nombre1 + nombre2
    callback(somme)
}

addition(1, 2, function(res) {
    console.log(res)
})
</code></pre>

<p>Il est possible d'imbriquer les callbacks mais cela devient difficile à lire.</p>
<p>Pour gérer les erreurs, on peut utiliser 2 paramètres, le 2e est les données, le 1er est l'erreur qui est null ou undefined s'il n'y a pas d'erreur</p>
<pre><code class="js">const fs = require('fs')
fs.readFile('./math.js', function(err, data) {
    if (err) {
        console.log('erreur !')
        throw err
    }
    console.log('résultat ok !')
    console.log(data)
})
console.log('coucou')
</code></pre>

<pre><code>coucou
résultat ok !
&lt;Buffer 65 78 70 6f 72 74 20 64 65 66 61 75 6c 74 20 66 75 6e 63 74 69 6f 6e 20 73 75 6d 28 61 2c 20 62 29 20 7b 0a 20 20 20 20 72 65 74 75 72 6e 20 61 20 2b ... &gt;
</code></pre>

<h3 id="promises">Promises</h3>
<p>Les <strong>promises</strong>, promesses en français, sont une autre façon de gérer du code asynchrone arrivées avec l'ES6 (ES2015). Une fonction exécutant du code asynchrone va immédiatement nous retourner une <em>promesse</em> (un objet <strong>Promise</strong>) qu'un résultat nous sera renvoyé prochainement. Une promesse peut être <strong>resolve</strong> avec un résultat,  <strong>reject</strong> avec une erreur, ou <strong>pending</strong> si elle est en attente de résultat.</p>
<p>On peut utiliser sa fonction <strong>then()</strong> pour exécuter du code dès que la promesse est résolue ou sa fonction <strong>catch()</strong> dès qu'une erreur est survenue.</p>
<pre><code class="js">// définition de la promesse
var promise = new Promise(function (resolve, reject) {
    // Ici je fais mon traitement, mes appels http…

    if (/* tout a fonctionné */) {
        resolve(&quot;Tout est OK!&quot;)
    }
    else {
        reject(Error(&quot;Hmm c'est embêtant…&quot;))
    }
})
// utilisation de la promesse
promise.then(
    function (result) {
        console.log(result) // &quot;Tout est OK!&quot;
    }, function (err) {
        console.log(err) // Error: &quot;Hmm c'est embêtant…&quot;
    }
)
</code></pre>

<pre><code class="js">// écriture équivalente
promise
    .then(function(result) {
        console.log(result) // &quot;Tout est OK!&quot;
    })
    .catch(function(error) {
        console.log(error)
    })
</code></pre>

<p>Il est possible de chaîner les promesses en enchaînant les <em>.then()</em> et les <em>.catch()</em></p>
<h3 id="async-await">Async / await</h3>
<p><strong>async</strong> et <strong>await</strong> sont 2 nouveaux mots clés sortis avec l'ES7 (ES2016) qui permettent de gérer l'asynchrone de manière plus simple.
Une fonction asynchrone doit avoir le mot clé async, et lorsqu'on l'appel et qu'on veut attendre son résultat, il faut écrire await devant l'appel de la fonction</p>
<pre><code class="js">async function asyncFunction1(a, b) {
    return a + b
}
const asyncFunction2 = async (a, b) =&gt; a + b

async function asyncFunction3() {
    const a = await asyncFunction1(1, 2)
    const b = await asyncFunction2(3, 4)
    console.log('affichage dans la fonction : ', a + b)
    return a + b
}
console.log(&quot;affichage à l'appel la fonction : &quot;, asyncFunction3()) // Promise { &lt;pending&gt; }
</code></pre>

<pre><code>affichage à l'appel la fonction :  Promise { &lt;pending&gt; }
affichage dans la fonction :  10
</code></pre>

<p>async et await utilisent les promesses, il est donc possible de les combiner. Pour gérer les erreurs, il faut utiliser un bloc <code>try {} catch (e) {}</code>.</p>
<pre><code class="js">const promise = new Promise(function(resolve, reject) {
    // Ici je fais mon traitement, mes appels http…
    if (Math.random() &gt; 0.5) {
        resolve('Tout est OK!')
    } else {
        reject(Error(&quot;Hmm c'est embêtant…&quot;))
    }
})

async function myAsyncFunction() {
    try {
        // Ici &quot;myPromise &quot; est résolue
        const res = await promise
        return `résultat : ${res}`
    } catch (err) {
        // Ici &quot;myPromise &quot; est rejetée
        return `résultat : ${err}`
    }
}

async function main() {
    const res = await myAsyncFunction()
    console.log(res)
    // retourne une deux 2 lignes suivantes aléatoirement :
    // résultat : Tout est OK!
    // résultat : Error: Hmm c'est embêtant…
}
main()
</code></pre></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>
            var base_url = "..",
                shortcuts = {"search": 83, "next": 78, "help": 191, "previous": 80};
        </script>
        <script src="../js/base.js" defer></script>
        <script src="../search/main.js" defer></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
